---
title: "Statistical Analysis"
author: "Kerri Miazgowicz"
organization: "University of Georgia"
date: "May 17, 2019"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Setting the working directory and loading the files
```{r }
# Set working directory
mainDir = "C:/Users/Kerri/Desktop/Fluctuation_BayesianFits"
setwd(mainDir)

library(ggplot2)
library(ggfortify)
library(survival)
library(coxme)
library(dplyr)

# importing data set
const_data <- as.data.frame(read.csv("data/constant_master.csv"))
fluc9_data <- as.data.frame(read.csv("data/fluc_dtr9_master.csv"))
fluc12_data <- as.data.frame(read.csv("data/fluc_dtr12_master.csv"))

#resassigning colm classifications for const data set
const_data$Treatment <- as.integer(const_data$Treatment)
const_data$Date <- as.character(const_data$Date)
const_data$Date2 <- as.POSIXlt(const_data$Date, format = "%m/%d/%Y")
const_data$Female <- as.factor(const_data$Female)
const_data$Treatment <- as.factor(const_data$Treatment)
const_data$Program <- "constant"
#remove 36C data and drop unused levels
const_data <- const_data[!const_data$Treatment == 36,]
const_data <- droplevels(const_data)

  # Reassigning colm classifications
fluc9_data$Treatment <- as.integer(fluc9_data$Treatment)
fluc9_data$Date <- as.character(fluc9_data$Date)
fluc9_data$Date2 <- as.POSIXlt(fluc9_data$Date, format = "%m/%d/%Y")
fluc9_data$Female <- as.factor(fluc9_data$Female)
fluc9_data$Treatment <- as.factor(fluc9_data$Treatment)
fluc9_data$Program <- "dtr 9"


#reassigning colm classifcations for the 12DTR set
fluc12_data$Treatment <- as.integer(fluc12_data$Treatment)
fluc12_data$Date <- as.character(fluc12_data$Date)
fluc12_data$Date2 <- as.POSIXlt(fluc12_data$Date, format = "%m/%d/%Y")
fluc12_data$Female <- as.factor(fluc12_data$Female)
fluc12_data$Treatment <- as.factor(fluc12_data$Treatment)
fluc12_data$Program <- "dtr 12"


#replace "block" and "individual" values within each dataset with '.DTR0, 9, or 12' so that when I merge all data together those stay seperate; will become string value
#convert block to a string variable and then add a character segment to it
const_data$Block <- paste0(as.character(const_data$Block),".dtr0")
const_data$Female <- paste0(as.character(const_data$Female),".dtr0")
fluc9_data$Block <- paste0(as.character(fluc9_data$Block), ".dtr9")
fluc9_data$Female <- paste0(as.character(fluc9_data$Female), ".dtr9")
fluc12_data$Block <- paste0(as.character(fluc12_data$Block), ".dtr12")
fluc12_data$Female <- paste0(as.character(fluc12_data$Female), ".dtr12")


#Combine all raw datasets together for stats later on
all.data <- rbind(const_data,fluc9_data,fluc12_data)

```


##Plotting fecundity (aka daily egg output as an average between replicates)
```{r}
#fecundity
#Figure 1B- Fecundity across time = Mean [number of eggs laid on a given day divided by the number of individuals alive on that day
#EFD= sum(Count)/tot Female alive on each day 

#constant
EFD.const_data <- subset(const_data, select = c(Treatment, Day, Count, Female, Laid, Block, Program))
EFD.const_data$Count[which(is.na(EFD.const_data$Count=="NA"))] <- 0 

day.EFD.const.block <- summarise(group_by(EFD.const_data,Treatment,Day,Block, Program), tot.count= sum(Count), tot.alive= n(), EFD= tot.count/tot.alive)

day.EFD.const.summary <- summarise(group_by(day.EFD.const.block, Treatment, Day, Program), ave = mean(EFD), SEM = sd(EFD)/sqrt(length(EFD)))

### dtr 9 
EFD.dtr9_data <- subset(fluc9_data, select = c(Treatment, Day, Count, Female, Laid, Block, Program))
EFD.dtr9_data$Count[which(is.na(EFD.dtr9_data$Count=="NA"))] <- 0 

day.EFD.dtr9.block <- summarise(group_by(EFD.dtr9_data,Treatment,Day,Block, Program), tot.count= sum(Count), tot.alive= n(), EFD= tot.count/tot.alive)

day.EFD.dtr9.summary <- summarise(group_by(day.EFD.dtr9.block, Treatment, Day, Program), ave = mean(EFD), SEM = sd(EFD)/sqrt(length(EFD)))

### dtr 12
EFD.dtr12_data <- subset(fluc12_data, select = c(Treatment, Day, Count, Female, Laid, Block, Program))
EFD.dtr12_data$Count[which(is.na(EFD.dtr12_data$Count=="NA"))] <- 0 

day.EFD.dtr12.block <- summarise(group_by(EFD.dtr12_data,Treatment,Day,Block, Program), tot.count= sum(Count), tot.alive= n(), EFD= tot.count/tot.alive)

day.EFD.dtr12.summary <- summarise(group_by(day.EFD.dtr12.block, Treatment, Day, Program), ave = mean(EFD), SEM = sd(EFD)/sqrt(length(EFD)))


#Combine all summary datasets together for plotting to work
all.EFD.day.block <- rbind(day.EFD.const.block,day.EFD.dtr9.block,day.EFD.dtr12.block)
  
all.EFD.day.summary <- rbind(day.EFD.const.summary, day.EFD.dtr9.summary, day.EFD.dtr12.summary)
all.EFD.day.summary$Program <- as.factor(all.EFD.day.summary$Program)
#reorder levels
all.EFD.day.summary$Program <- ordered(all.EFD.day.summary$Program, levels = c("constant", "dtr 9", "dtr 12"))

x <- ggplot(all.EFD.day.block, aes(x=Day, y= EFD, group= Program, colour= Program)) + 
  #geom_point(shape = 19, size =1, alpha = 0.4) +
  #scale_linetype_manual(values = c("solid", "longdash", "dotted"))+
  geom_line(data = all.EFD.day.summary, aes(x = Day, y = ave), size = 1.1, alpha = 0.8)+
  scale_color_manual(values= c("black", "dodgerblue", "purple")) +
  scale_x_continuous(name= "Days at Treatment", limits = c(0,100), breaks = seq(0,100,20) ) +
scale_y_continuous(name= "Fecundity", limits = c(0,50), breaks = seq(0,50,10)) +
   theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5), legend.title = element_blank())

plot.fecundity <- x+ facet_grid(Treatment ~ .) #+ theme(strip.background = element_blank(), strip.text = element_blank()) 


library(ggpubr)

plot.fecundity
output <- ggarrange(plot.fecundity, labels = c("C"), font.label = list(size =14))
ggsave("plots/fecundityplot_paneltemp.png", output, path = NULL, scale = 1, width = 3.5, height = 5.5, device = 'png', dpi = 600)

##Courtney wanted me to display fecundity by day as in the constant temp manuscript. I'll add a dotted line as the loess curve over the data

e <- ggplot(all.EFD.day.block, aes(x=Day, y= EFD, group= Program, colour= Program)) + 
  geom_point(shape = 19, size =1, alpha = 0.4) +
  scale_linetype_manual(values = c("solid", "longdash", "dotted"))+
  #geom_line(data = all.EFD.day.block, aes(x = Day, y = EFD), size = 0.6, alpha = 0.3)+
   geom_smooth(aes(y = EFD, fill = factor(Treatment)), method = "loess", linetype = "solid", se = FALSE, size = 1, alpha = 0.5)  +
  scale_color_manual(values= c("black", "dodgerblue", "purple")) +
  scale_x_continuous(name= "Days at Treatment", limits = c(0,100), breaks = seq(0,100,20) ) +
scale_y_continuous(name= "Daily egg production", limits = c(0,50), breaks = seq(0,50,10)) +
   theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5), legend.title = element_blank())

plot.eggs3 <- e + facet_grid(Treatment ~ .) #+ theme(strip.background = element_blank(), strip.text = element_blank()) 

output <- ggarrange(plot.eggs3, labels = c("b"), font.label = list(size =14))
ggsave("plots/Dailyeggproductionplot_paneltemp.png", output, path = NULL, scale = 1, width = 3.5, height = 5.5, device = 'png', dpi = 600)


```

Creating a Day x Daily Porportion imbibing blood temperature*Program panel
```{r}
#fecundity
#Figure 1A- Porportion of females imbibing blood across time = Mean [#females feeding on a given day divided by the number of individuals alive on that day]
#BFD= sum(Feed)/tot Female alive on each day 

#constant
BFD.const_data <- subset(const_data, select = c(Treatment, Day, Female, Feed, Block, Program))
BFD.const_data$Feed[which(is.na(BFD.const_data$Feed=="NA"))] <- 0 

day.BFD.const.block <- summarise(group_by(BFD.const_data,Treatment,Day,Block, Program), tot.fed = sum(Feed), tot.alive= n(), BFD= tot.fed/tot.alive)

day.BFD.const.summary <- summarise(group_by(day.BFD.const.block, Treatment, Day, Program), ave = mean(BFD), SEM = sd(BFD)/sqrt(length(BFD)))

### dtr 9 
BFD.dtr9_data <- subset(fluc9_data, select = c(Treatment, Day, Female, Feed, Block, Program))
BFD.dtr9_data$Feed[which(is.na(BFD.dtr9_data$Feed=="NA"))] <- 0 

day.BFD.dtr9.block <- summarise(group_by(BFD.dtr9_data,Treatment,Day,Block, Program), tot.fed= sum(Feed), tot.alive= n(), BFD= tot.fed/tot.alive)

day.BFD.dtr9.summary <- summarise(group_by(day.BFD.dtr9.block, Treatment, Day, Program), ave = mean(BFD), SEM = sd(BFD)/sqrt(length(BFD)))

### dtr 12
BFD.dtr12_data <- subset(fluc12_data, select = c(Treatment, Day, Female, Feed, Block, Program))
BFD.dtr12_data$Feed[which(is.na(BFD.dtr12_data$Feed=="NA"))] <- 0 

day.BFD.dtr12.block <- summarise(group_by(BFD.dtr12_data,Treatment,Day,Block, Program), tot.fed= sum(Feed), tot.alive= n(), BFD= tot.fed/tot.alive)

day.BFD.dtr12.summary <- summarise(group_by(day.BFD.dtr12.block, Treatment, Day, Program), ave = mean(BFD), SEM = sd(BFD)/sqrt(length(BFD)))

#Combine all summary datasets together for plotting to work
all.BFD.day.block <- rbind(day.BFD.const.block,day.BFD.dtr9.block,day.BFD.dtr12.block)
  
all.BFD.day.summary <- rbind(day.BFD.const.summary, day.BFD.dtr9.summary, day.BFD.dtr12.summary)
all.BFD.day.summary$Program <- as.factor(all.BFD.day.summary$Program)
#reorder levels
all.BFD.day.summary$Program <- ordered(all.BFD.day.summary$Program, levels = c("constant", "dtr 9", "dtr 12"))


##Courtney wanted me to display fecundity by day as in the constant temp manuscript. I'll add a dotted line as the loess curve over the data

bite <- ggplot(all.BFD.day.block, aes(x=Day, y= BFD, group= Program, colour= Program)) + 
  geom_point(shape = 19, size =1, alpha = 0.4) +
  scale_linetype_manual(values = c("solid", "longdash", "dotted"))+
  #geom_line(data = all.BFD.day.block, aes(x = Day, y = BFD), size = 0.6, alpha = 0.3)+
   geom_smooth(aes(y = BFD, fill = factor(Treatment)), method = "loess", linetype = "solid", se = FALSE, size = 1, alpha = 0.5)  +
  scale_color_manual(values= c("black", "dodgerblue", "purple")) +
  scale_x_continuous(name= "Days at Treatment", limits = c(0,100), breaks = seq(0,100,20) ) +
scale_y_continuous(name= "Daily porportion imbibing blood", limits = c(0,1), breaks = seq(0,1,.2)) +
   theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5), legend.title = element_blank())

plot.bites2 <- bite + facet_grid(Treatment ~ .) #+ theme(strip.background = element_blank(), strip.text = element_blank()) 

output <- ggarrange(plot.bites2, labels = c("a"), font.label = list(size =14))
ggsave("plots/Dailybitingporpplot2_paneltemp.png", output, path = NULL, scale = 1, width = 3.5, height = 5.5, device = 'png', dpi = 600)



```

GLMM models for the daily proportion of females imbibing blood
```{r}
library(tidyr)
library(lme4)
#Create a dataset that is specific to the feed data - removing all rows where there is no DV present
all.feeddata <- subset(all.data, select = c("Treatment", "Block", "Donor", "Female", "Feed", "Day", "Program"))
all.feeddata <- all.feeddata %>% drop_na(Feed)

all.feeddata$Temp <- as.character(all.feeddata$Treatment)
all.feeddata$Temp <- as.integer(all.feeddata$Temp)
#Following Courtney's code, making Temperature a continuous variable
all.feeddata$Block <- as.factor(all.feeddata$Block)
all.feeddata$Donor <- as.factor(all.feeddata$Donor)
all.feeddata$Female <- as.factor(all.feeddata$Female)
all.feeddata$Program <- as.factor(all.feeddata$Program)
#Centering and scaling continuous variables of interest (Treatment, Day)
all.feeddata$Tscale <- scale(all.feeddata$Temp)
all.feeddata$Dscale <- scale(all.feeddata$Day)

#Model Exploration
library(MuMIn)
Feed.m1 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Block) + (1|Female) + (1|Donor), family = binomial, data = all.feeddata) #poor fit
Feed.m2 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Block) + (1|Donor), family = binomial, data = all.feeddata)
Feed.m3 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Female) + (1|Donor), family = binomial, data = all.feeddata)# poor fit
Feed.m4 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Block) + (1|Female), family = binomial, data = all.feeddata)#poor fit
Feed.m5 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Block), family = binomial, data = all.feeddata)
Feed.m6 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Female), family = binomial, data = all.feeddata)#poor fit
Feed.m7 <- glmer(Feed ~ Dscale * Tscale* Program + (1|Donor), family = binomial, data = all.feeddata)
Feed.m41 <- glmer(Feed~ Tscale*Program + Dscale + (1|Donor), family = binomial, data = all.feeddata)

Feed.m8 <- glm(Feed ~ Tscale, family = binomial, data = all.feeddata)
Feed.m9 <- glm(Feed ~ Dscale, family = binomial, data = all.feeddata)
Feed.m10 <- glm(Feed ~ Program, family = binomial, data = all.feeddata)
Feed.m11 <- glm(Feed ~ Tscale + Dscale, family = binomial, data = all.feeddata)
Feed.m12 <- glm(Feed ~ Tscale * Dscale, family = binomial, data = all.feeddata)
Feed.m13 <- glm(Feed ~ Tscale + Dscale, family = binomial, data = all.feeddata)
Feed.m14 <- glm(Feed ~ Tscale * Program, family = binomial, data = all.feeddata)
Feed.m15 <- glm(Feed ~ Tscale * Program + Dscale, family = binomial, data = all.feeddata)

Feed.m16 <- glmer(Feed ~ Tscale + (1|Block), family = binomial, data = all.feeddata)
Feed.m17 <- glmer(Feed ~ Dscale + (1|Block), family = binomial, data = all.feeddata)
Feed.m18 <- glmer(Feed ~ Program + (1|Block), family = binomial, data = all.feeddata)

Feed.m19 <- glmer(Feed ~ Tscale + (1|Donor), family = binomial, data = all.feeddata)
Feed.m20 <- glmer(Feed ~ Dscale + (1|Donor), family = binomial, data = all.feeddata)
Feed.m21 <- glmer(Feed ~ Program + (1|Donor), family = binomial, data = all.feeddata)

Feed.m22 <- glmer(Feed ~ Tscale + (1|Female), family = binomial, data = all.feeddata)
Feed.m23 <- glmer(Feed ~ Dscale + (1|Female), family = binomial, data = all.feeddata)
Feed.m24 <- glmer(Feed ~ Program + (1|Female), family = binomial, data = all.feeddata)

Feed.m25 <- glmer(Feed ~ Tscale * Dscale + (1|Block), family = binomial, data = all.feeddata)
Feed.m26 <- glmer(Feed ~ Tscale * Dscale + (1|Block) + (1|Female), family = binomial, data = all.feeddata)#poor fit
Feed.m27 <- glmer(Feed ~ Tscale * Dscale + (1|Female), family = binomial, data = all.feeddata)#poor fit

Feed.m28 <- glmer(Feed ~ Tscale * Program + (1|Block), family = binomial, data = all.feeddata)
Feed.m29 <- glmer(Feed ~ Tscale * Program + (1|Block) + (1|Female), family = binomial, data = all.feeddata)#poor fit
Feed.m30 <- glmer(Feed ~ Tscale * Program + (1|Female), family = binomial, data = all.feeddata)#poor fit

Feed.m31 <- glmer(Feed ~ Program * Dscale + (1|Block), family = binomial, data = all.feeddata)
Feed.m32 <- glmer(Feed ~ Program * Dscale + (1|Block) + (1|Female), family = binomial, data = all.feeddata)
Feed.m33 <- glmer(Feed ~ Program * Dscale + (1|Female), family = binomial, data = all.feeddata)

Feed.m34 <- glmer(Feed ~ Tscale * Dscale + (1|Donor) + (1|Female), family = binomial, data = all.feeddata) #poor fit
Feed.m35 <- glmer(Feed ~ Tscale * Dscale + (1|Female), family = binomial, data = all.feeddata)#poor fit
Feed.m36 <- glmer(Feed ~ Tscale * Dscale + (1|Block)+ (0+Day|Female), family = binomial, data = all.feeddata)
#poor fit
Feed.m37 <- glmer(Feed ~Tscale * Dscale + (1|Female), family = binomial, data = all.feeddata )#poor fit
Feed.m38 <- glmer(Feed ~Tscale * Dscale + (Dscale|Female) + (1|Block), family = binomial, data = all.feeddata)
Feed.m39 <- glmer(Feed ~ Tscale + (1|Donor) + (1|Block), family = binomial, data = all.feeddata)
Feed.m40 <- glmer(Feed ~ Tscale + (1|Donor) + (1|Female), family = binomial, data = all.feeddata)

modlist <- list(Feed.m1,Feed.m2,Feed.m3,Feed.m4,Feed.m5,Feed.m6,Feed.m7,Feed.m8,Feed.m9,Feed.m10,Feed.m11, Feed.m12, Feed.m13, Feed.m14, Feed.m15, Feed.m16, Feed.m17,Feed.m18, Feed.m19, Feed.m20, Feed.m21, Feed.m22, Feed.m23, Feed.m24, Feed.m25, Feed.m26, Feed.m27, Feed.m28, Feed.m29, Feed.m30, Feed.m31, Feed.m32, Feed.m33, Feed.m34, Feed.m35, Feed.m36, Feed.m37, Feed.m38, Feed.m39, Feed.m40, Feed.m41)

selection.table <- model.sel(modlist)
#Best models =  7, 2, 39 (of the ones without errors while computing the model)
summary(Feed.m7)
summary(Feed.m41)

```

#Temperature-specific eggs per female per day
#Option #1 = Calculate the average number of eggs on a day (SEM across days, not blocks) for each temp
#Option #2 = Calculate the total number of eggs laid by each female and divide by her lifespan. Average the EFD across all individuals at each temperature treatment

## side-by side bar graphs for Option #1
```{r}
library (RColorBrewer)
library (ggplot2)

#Calculating and plotting option #1 (Calculate the average number of eggs on a day (SEM across days, not blocks) for each temp)
#Calculate daily EFD across blocks
day.EFD.const.1 <- summarise(group_by(EFD.const_data, Treatment, Day, Program), tot.count= sum(Count), tot.alive= n(), EFD= tot.count/tot.alive)
temp.EFD.const.summary.1 <- summarise(group_by(day.EFD.const.1, Treatment, Program), ave = mean(EFD), SEM = sd(EFD)/sqrt(length(EFD)))

#dtr9
day.EFD.dtr9.1 <- summarise(group_by(EFD.dtr9_data, Treatment, Day, Program), tot.count= sum(Count), tot.alive= n(), EFD= tot.count/tot.alive)
temp.EFD.dtr9.summary.1 <- summarise(group_by(day.EFD.dtr9.1, Treatment, Program), ave = mean(EFD), SEM = sd(EFD)/sqrt(length(EFD)))


#dtr12
day.EFD.dtr12.1 <- summarise(group_by(EFD.dtr12_data, Treatment, Day, Program), tot.count= sum(Count), tot.alive= n(), EFD= tot.count/tot.alive)
temp.EFD.dtr12.summary.1 <- summarise(group_by(day.EFD.dtr12.1, Treatment, Program), ave = mean(EFD), SEM = sd(EFD)/sqrt(length(EFD)))

#merge the dataframes together 
all.temp.EFD.summary.1 <- rbind(temp.EFD.const.summary.1, temp.EFD.dtr9.summary.1, temp.EFD.dtr12.summary.1)

#for coloring
categories <- aggregate(Program~Treatment,all.temp.EFD.summary.1,function(x)length(unique(x)))  #number of sub-category for each category 
category.palettes <- c("Purples", "Blues", "Greens", "Oranges", "Reds") 
colors <- unlist(lapply(1:nrow(categories), function(i){colorRampPalette(brewer.pal(9,category.palettes[i])[3:7])(categories[i,2])}))
names <- sort(unique(all.temp.EFD.summary.1$Treatment))


#for EFD
all.temp.EFD.summary.1$Program <- as.factor(all.temp.EFD.summary.1$Program)
all.temp.EFD.summary.1$Program <- factor(all.temp.EFD.summary.1$Program, levels = c("constant", "dtr 9", "dtr 12"))


ggplot(all.temp.EFD.summary.1, aes(x=Treatment, y=ave, fill = interaction(Program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
  scale_fill_manual("Temperature", values = colors, breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "Daily egg production (EFD)", limits = c(0,20), breaks = seq(0,20,5)) +
  geom_errorbar(aes(ymin = ave - SEM, ymax = ave  + SEM), width=0.4, size = 1, position = position_dodge(.9)) +
  theme_classic(base_size = 20)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))


```

###### side-by side bar graphs for Option #2
Calculate the total number of eggs laid by each female and divide by her lifespan. Average the EFD across all individuals at each temperature treatment
```{r}
#Determine the lifespan and lifetime egg production for each female
constant.individual.trait <- summarise(group_by(EFD.const_data, Female, Treatment, Program), lifespan = max(Day), lifetime.eggs = sum(Count), EFD = lifetime.eggs/lifespan) %>% ungroup()
fluc9.individual.trait <- summarise(group_by(EFD.dtr9_data, Female, Treatment, Program), lifespan = max(Day),lifetime.eggs = sum(Count), EFD = lifetime.eggs/lifespan) %>% ungroup()
fluc12.individual.trait <- summarise(group_by(EFD.dtr12_data, Female, Treatment, Program), lifespan = max(Day), lifetime.eggs = sum(Count), EFD = lifetime.eggs/lifespan) %>% ungroup()

#Average values across all females within a temperature treatment 
##########
#constand
temp.constant.individual.trait.summary <- summarise(group_by(constant.individual.trait, Treatment, Program), mean.lifetime.eggs = mean(lifetime.eggs), SEM.mean.lifetime.eggs = sd(lifetime.eggs)/ sqrt(length(lifetime.eggs)), mean.EFD = mean(EFD), SEM.mean.EFD = sd(EFD)/sqrt(length(EFD))) %>% ungroup()
#dtr9
temp.dtr9.individual.trait.summary <- summarise(group_by(fluc9.individual.trait, Treatment, Program), mean.lifetime.eggs = mean(lifetime.eggs), SEM.mean.lifetime.eggs = sd(lifetime.eggs)/ sqrt(length(lifetime.eggs)), mean.EFD = mean(EFD), SEM.mean.EFD = sd(EFD)/sqrt(length(EFD))) %>% ungroup()
#dtr12
temp.dtr12.individual.trait.summary <- summarise(group_by(fluc12.individual.trait, Treatment, Program), mean.lifetime.eggs = mean(lifetime.eggs), SEM.mean.lifetime.eggs = sd(lifetime.eggs)/ sqrt(length(lifetime.eggs)),mean.EFD = mean(EFD), SEM.mean.EFD = sd(EFD)/sqrt(length(EFD)))%>% ungroup()


#######

#Combine datasets 
all.individual.temp.trait <- rbind(temp.constant.individual.trait.summary, temp.dtr9.individual.trait.summary, temp.dtr12.individual.trait.summary)
all.individual.temp.trait$Program <- as.factor(all.individual.temp.trait$Program)
all.individual.temp.trait$Program <- factor(all.individual.temp.trait$Program, levels = c("constant", "dtr 9", "dtr 12"))

#for coloring
categories <- aggregate(Program~Treatment,all.individual.temp.trait,function(x)length(unique(x)))  #number of sub-category for each category 
category.palettes <- c("Purples", "Blues", "Greens", "Oranges", "Reds") 
colors <- unlist(lapply(1:nrow(categories), function(i){colorRampPalette(brewer.pal(9,category.palettes[i])[3:7])(categories[i,2])}))
names <- sort(unique(all.individual.temp.trait$Treatment))

#EFD graph
ggplot(all.individual.temp.trait, aes(x=Treatment, y=mean.EFD, fill = interaction(Program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
  scale_fill_manual("Temperature", values = colors, breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "Daily egg production (EFD)", limits = c(0,20), breaks = seq(0,20,5)) +
  geom_errorbar(aes(ymin = mean.EFD - SEM.mean.EFD, ymax = mean.EFD  + SEM.mean.EFD), width=0.4, size = 1, position = position_dodge(.9)) +
  theme_classic(base_size = 20)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))

#Lifetime eggs graph
ggplot(all.individual.temp.trait, aes(x=Treatment, y=mean.lifetime.eggs, fill = interaction(Program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
  scale_fill_manual("Temperature", values = colors, breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "Lifetime Egg Production", limits = c(0,500), breaks = seq(0,500,50)) +
  geom_errorbar(aes(ymin = mean.lifetime.eggs - SEM.mean.lifetime.eggs, ymax = mean.lifetime.eggs  + SEM.mean.lifetime.eggs), width=0.4, size = 1, position = position_dodge(.9)) +
  theme_classic(base_size = 20)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))


#Make coloring comparable to survivorship figure (black, dodgerblue, purple) for Lifetime egg production
plot.lifetime.eggs <- ggplot(data = all.individual.temp.trait, aes(x=Treatment, y=mean.lifetime.eggs, fill = interaction(Program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
  scale_fill_manual("Temperature", values = c("black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple" ), breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "Lifetime egg production", limits = c(0,500), breaks = seq(0,500,50)) +
  geom_errorbar(aes(ymin = mean.lifetime.eggs - SEM.mean.lifetime.eggs, ymax = mean.lifetime.eggs  + SEM.mean.lifetime.eggs), width=0.4, size = 0.7, position = position_dodge(.9)) +
  theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))

plot.lifetime.eggs

output <- ggarrange(plot.lifetime.eggs, labels = c("D"), font.label = list(size =14))
ggsave("plots/lifeeggs_plot.png", output, path = NULL, scale = 1, width = 3.5, height = 2, device = 'png', dpi = 600)


```




The rest of this code is to explore GC based trends in the data, but not neccessary to be included in the manuscript
The below code needs to be updated as of 5/21/19 KM



#Looking at lifetime egg production, # of Gc, GC duration
```{r}
library(dplyr)
#Ran my GC algorithm on the constant, dtr 9, and dtr 12 datasets in external R code files.
#Import the datasets here
GC_constant_data <- read.csv("data/GC_master_constant.csv")
GC_dtr9_data <- read.csv("data/GC_master_dtr9.csv")
GC_dtr12_data <- read.csv("data/GC_master_dtr12.csv")


#First I have add in lifespan of the individual
#Constant
GC_specific <- mutate(group_by(GC_constant_data,Female), Lifespan = max(Day))
#Adding in bite associated variables of interest
GC_specific <- mutate(group_by(GC_specific, Female, GC), Duration = n(), no.Bites = sum(Feed == 1)) %>% ungroup()
#I have to do eggs counts seperate due to the difference in grouping definitions
GC_specific <- mutate(group_by(GC_specific,Female, eggGroup),no.Lays = sum(Laid == 1), no.Eggs = max(GCeggCount)) %>% ungroup() 

#DTR9
GC_specific.dtr9 <- mutate(group_by(GC_dtr9_data,Female), Lifespan = max(Day))
GC_specific.dtr9 <- mutate(group_by(GC_specific.dtr9, Female, GC), Duration = n(), no.Bites = sum(Feed == 1)) %>% ungroup()
GC_specific.dtr9 <- mutate(group_by(GC_specific.dtr9,Female, eggGroup),no.Lays = sum(Laid == 1), no.Eggs = max(GCeggCount)) %>% ungroup() 

#DTR12
GC_specific.dtr12 <- mutate(group_by(GC_dtr12_data,Female), Lifespan = max(Day))
GC_specific.dtr12 <- mutate(group_by(GC_specific.dtr12, Female, GC), Duration = n(), no.Bites = sum(Feed == 1)) %>% ungroup()
GC_specific.dtr12 <- mutate(group_by(GC_specific.dtr12,Female, eggGroup),no.Lays = sum(Laid == 1), no.Eggs = max(GCeggCount)) %>%
  ungroup() 

#I need to correct the disconnect in the number of Eggs between EggGroup and GC
#To do this I need to create a new column no.Eggs which assigns no.Eggs.1 for GC == egggroup
#Then I need to add in the value of no.Eggs.1 for EggGroup to where EggGroup = GC
for (i in 1:length(GC_specific$no.Eggs))
{
if (GC_specific$eggGroup[i] != GC_specific$GC[i]){
  GC_specific$no.Eggs[i] = GC_specific$no.Eggs[i+1]
}
  }

#DTR9
for (i in 1:length(GC_specific.dtr9$no.Eggs))
{
if (GC_specific.dtr9$eggGroup[i] != GC_specific.dtr9$GC[i]){
  GC_specific.dtr9$no.Eggs[i] = GC_specific.dtr9$no.Eggs[i+1]
}
  }

#DTR12
for (i in 1:length(GC_specific.dtr12$no.Eggs))
{
if (GC_specific.dtr12$eggGroup[i] != GC_specific.dtr12$GC[i]){
  GC_specific.dtr12$no.Eggs[i] = GC_specific.dtr12$no.Eggs[i+1]
}
  }


#To remove the time prior to the first blood meal, and the last GC if no eggs were laid
#Remove all rows where no.Eggs = 0
GC_specific <- GC_specific[!(GC_specific$no.Eggs == 0),]

#In order for distict to work properly I need to remove all the other rows that dont matter.
GC_specific <- dplyr::select(GC_specific, Treatment, Block, Female, GC, Lifespan, Duration, no.Bites, no.Lays, no.Eggs)

#I really only care about the values per each GC so I minimize the df like so
#Need to reimplement the grouping by female
GC_specific <- distinct(group_by(GC_specific, Female, GC), .keep_all = TRUE)


#So that things average properly I need to add in 0s for all places that there is a NA or NAN
GC_specific$no.Bites[is.na(GC_specific$no.Bites)] <- 0


#DTR9
GC_specific.dtr9 <- GC_specific.dtr9[!(GC_specific.dtr9$no.Eggs == 0),]
GC_specific.dtr9 <- dplyr::select(GC_specific.dtr9, Treatment, Block, Female, GC, Lifespan, Duration, no.Bites, no.Lays, no.Eggs)
GC_specific.dtr9 <- distinct(group_by(GC_specific.dtr9, Female, GC), .keep_all = TRUE)
GC_specific.dtr9$no.Bites[is.na(GC_specific.dtr9$no.Bites)] <- 0

#DTR12
GC_specific.dtr12 <- GC_specific.dtr12[!(GC_specific.dtr12$no.Eggs == 0),]
GC_specific.dtr12 <- dplyr::select(GC_specific.dtr12, Treatment, Block, Female, GC, Lifespan, Duration, no.Bites, no.Lays, no.Eggs)
GC_specific.dtr12 <- distinct(group_by(GC_specific.dtr12, Female, GC), .keep_all = TRUE)
GC_specific.dtr12$no.Bites[is.na(GC_specific.dtr12$no.Bites)] <- 0


#Create a df that contains averages of the values across Females
Female_specific <-group_by(GC_specific, Female) %>%
                        mutate( ave.Duration = mean(Duration), ave.no.Bites = mean(no.Bites), ave.no.Lays = mean(no.Lays), ave.no.Eggs = mean(no.Eggs), Total = sum(no.Eggs) ,sem.Duration = (sd(Duration)/sqrt(length(Duration))),sem.no.Bites = (sd(no.Bites)/sqrt(length(no.Bites))) ,sem.no.Lays = (sd(no.Lays)/sqrt(length(no.Lays))), sem.no.Eggs = (sd(no.Eggs)/sqrt(length(no.Eggs))))
#Keep only distinct Females
Female_specific <- distinct(Female_specific, Female, .keep_all = TRUE)


###DTR9
Female_specific.dtr9 <-group_by(GC_specific.dtr9, Female) %>%
                        mutate( ave.Duration = mean(Duration), ave.no.Bites = mean(no.Bites), ave.no.Lays = mean(no.Lays), ave.no.Eggs = mean(no.Eggs), Total = sum(no.Eggs) ,sem.Duration = (sd(Duration)/sqrt(length(Duration))),sem.no.Bites = (sd(no.Bites)/sqrt(length(no.Bites))) ,sem.no.Lays = (sd(no.Lays)/sqrt(length(no.Lays))), sem.no.Eggs = (sd(no.Eggs)/sqrt(length(no.Eggs))))
#Keep only distinct Females
Female_specific.dtr9 <- distinct(Female_specific.dtr9, Female, .keep_all = TRUE)

###DTR12
Female_specific.dtr12 <-group_by(GC_specific.dtr12, Female) %>%
                        mutate( ave.Duration = mean(Duration), ave.no.Bites = mean(no.Bites), ave.no.Lays = mean(no.Lays), ave.no.Eggs = mean(no.Eggs), Total = sum(no.Eggs) ,sem.Duration = (sd(Duration)/sqrt(length(Duration))),sem.no.Bites = (sd(no.Bites)/sqrt(length(no.Bites))) ,sem.no.Lays = (sd(no.Lays)/sqrt(length(no.Lays))), sem.no.Eggs = (sd(no.Eggs)/sqrt(length(no.Eggs))))
#Keep only distinct Females
Female_specific.dtr12 <- distinct(Female_specific.dtr12, Female, .keep_all = TRUE)




#Or a df that averages across Treatments
Treatment_specific <-group_by(GC_specific, Treatment) %>%
  mutate( ave.Duration = mean(Duration), ave.no.Bites = mean(no.Bites), ave.no.Lays = mean(no.Lays), ave.no.Eggs = mean(no.Eggs), Total = sum(no.Eggs) ,sem.Duration = (sd(Duration)/sqrt(length(Duration))),sem.no.Bites = (sd(no.Bites)/sqrt(length(no.Bites))) ,sem.no.Lays = (sd(no.Lays)/sqrt(length(no.Lays))), sem.no.Eggs = (sd(no.Eggs)/sqrt(length(no.Eggs))))
#Keep only distinct Treatments
Treatment_specific <- distinct(Treatment_specific, Treatment, .keep_all = TRUE)


#DTR9
Treatment_specific.dtr9 <-group_by(GC_specific.dtr9, Treatment) %>%
  mutate( ave.Duration = mean(Duration), ave.no.Bites = mean(no.Bites), ave.no.Lays = mean(no.Lays), ave.no.Eggs = mean(no.Eggs), Total = sum(no.Eggs) ,sem.Duration = (sd(Duration)/sqrt(length(Duration))),sem.no.Bites = (sd(no.Bites)/sqrt(length(no.Bites))) ,sem.no.Lays = (sd(no.Lays)/sqrt(length(no.Lays))), sem.no.Eggs = (sd(no.Eggs)/sqrt(length(no.Eggs))))
#Keep only distinct Treatments
Treatment_specific.dtr9 <- distinct(Treatment_specific.dtr9, Treatment, .keep_all = TRUE)

#DTR12
Treatment_specific.dtr12 <-group_by(GC_specific.dtr12, Treatment) %>%
  mutate( ave.Duration = mean(Duration), ave.no.Bites = mean(no.Bites), ave.no.Lays = mean(no.Lays), ave.no.Eggs = mean(no.Eggs), Total = sum(no.Eggs) ,sem.Duration = (sd(Duration)/sqrt(length(Duration))),sem.no.Bites = (sd(no.Bites)/sqrt(length(no.Bites))) ,sem.no.Lays = (sd(no.Lays)/sqrt(length(no.Lays))), sem.no.Eggs = (sd(no.Eggs)/sqrt(length(no.Eggs))))
#Keep only distinct Treatments
Treatment_specific.dtr12 <- distinct(Treatment_specific.dtr12, Treatment, .keep_all = TRUE)



############
#Create a df to look at the # of GC per Female
GC_total <- mutate(group_by(GC_specific, Female), no.GC = max(GC))
GC_total <- distinct(GC_total, Female, .keep_all = TRUE)
temp_GC_total <- summarise(group_by(GC_total, Treatment), GC = mean(no.GC), SEM = sd(no.GC)/ sqrt(length(no.GC)))

#dtr9
GC_total.dtr9 <- mutate(group_by(GC_specific.dtr9, Female), no.GC = max(GC))
GC_total.dtr9 <- distinct(GC_total.dtr9, Female, .keep_all = TRUE)
temp_GC_total.dtr9 <- summarise(group_by(GC_total.dtr9, Treatment), GC = mean(no.GC), SEM = sd(no.GC)/ sqrt(length(no.GC)))

#dtr12
GC_total.dtr12 <- mutate(group_by(GC_specific.dtr12, Female), no.GC = max(GC))
GC_total.dtr12 <- distinct(GC_total.dtr12, Female, .keep_all = TRUE)
temp_GC_total.dtr12 <- summarise(group_by(GC_total.dtr12, Treatment), GC = mean(no.GC), SEM = sd(no.GC)/ sqrt(length(no.GC)))



##################3
#Create a df to observe Prob. of Biting Total #bites per GC / # days in GC
GC_prob.Bite <- mutate(group_by(GC_specific, Female, GC), prob.Bite = no.Bites/Duration)
GC_prob.Bite <- distinct(GC_prob.Bite, GC, .keep_all = TRUE)
temp_GC_prob.Bite <- summarise(group_by(GC_prob.Bite, Treatment), bite = mean(prob.Bite), SEM = sd(prob.Bite)/sqrt(length(prob.Bite)))

#dtr9
GC_prob.Bite.dtr9 <- mutate(group_by(GC_specific.dtr9, Female, GC), prob.Bite = no.Bites/Duration)
GC_prob.Bite.dtr9 <- distinct(GC_prob.Bite.dtr9, GC, .keep_all = TRUE)
temp_GC_prob.Bite.dtr9 <- summarise(group_by(GC_prob.Bite.dtr9, Treatment), bite = mean(prob.Bite), SEM = sd(prob.Bite)/sqrt(length(prob.Bite)))


#dtr12
GC_prob.Bite.dtr12 <- mutate(group_by(GC_specific.dtr12, Female, GC), prob.Bite = no.Bites/Duration)
GC_prob.Bite.dtr12 <- distinct(GC_prob.Bite.dtr12, GC, .keep_all = TRUE)
temp_GC_prob.Bite.dtr9 <- summarise(group_by(GC_prob.Bite.dtr12, Treatment), bite = mean(prob.Bite), SEM = sd(prob.Bite)/sqrt(length(prob.Bite)))


#################
#Create a df to look at the ave duration of# of GC per Female
GC_Duration <- mutate(group_by(GC_specific, Female), D2 = mean(Duration))
GC_Duration <- distinct(GC_Duration, Female, .keep_all = TRUE)
temp_GC_Duration <- summarise(group_by(GC_Duration, Treatment), Dur = mean(D2), SEM = sd(D2)/ sqrt(length(D2)))

#dtr9
GC_Duration.dtr9 <- mutate(group_by(GC_specific.dtr9, Female), D2 = mean(Duration))
GC_Duration.dtr9 <- distinct(GC_Duration.dtr9, FemaleF12, .keep_all = TRUE)
temp_GC_Duration.dtr9 <- summarise(group_by(GC_Duration.dtr9, Treatment), Dur = mean(D2), SEM = sd(D2)/ sqrt(length(D2)))

#dtr12
GC_Duration.dtr12 <- mutate(group_by(GC_specific.dtr12, Female), D2 = mean(Duration))
GC_Duration.dtr12 <- distinct(GC_Duration.dtr12, FemaleF12, .keep_all = TRUE)
temp_GC_Duration.dtr12 <- summarise(group_by(GC_Duration.dtr12, Treatment), Dur = mean(D2), SEM = sd(D2)/ sqrt(length(D2)))


################
#Create a df to look at the ave clutch size per female at each treatment
#ave the eggs per GC for each female; average across all females at each temperature
Clutch_size <- mutate(group_by(GC_specific, Female), clutch_f = mean(no.Eggs))
Clutch_size <- distinct(Clutch_size, Female, .keep_all = TRUE)
temp_clutch_size <- summarise(group_by(Clutch_size, Treatment), clutch = mean(clutch_f), SEM = sd(clutch_f)/sqrt(length (clutch_f)))

#dtr9
Clutch_size.dtr9 <- mutate(group_by(GC_specific.dtr9, Female), clutch_f = mean(no.Eggs))
Clutch_size.dtr9 <- distinct(Clutch_size.dtr9, Female, .keep_all = TRUE)
temp_clutch_size.dtr9 <- summarise(group_by(Clutch_size.dtr9, Treatment), clutch = mean(clutch_f), SEM = sd(clutch_f)/sqrt(length (clutch_f)))

#dtr12
Clutch_size.dtr12 <- mutate(group_by(GC_specific.dtr12, Female), clutch_f = mean(no.Eggs))
Clutch_size.dtr12 <- distinct(Clutch_size.dtr12, Female, .keep_all = TRUE)
temp_clutch_size.dtr12 <- summarise(group_by(Clutch_size.dtr12, Treatment), clutch = mean(clutch_f), SEM = sd(clutch_f)/sqrt(length (clutch_f)))


```

Side-by-side bar graphs comparing GC dur, #GC, and lifetime egg production between constant and fluctuation
```{r}
#For graphing I do not need constant temp 36C; remove that data and drop the level associated with it.
temp_GC_Duration <- temp_GC_Duration[!temp_GC_Duration$Treatment == 36,]
temp_GC_Duration <- droplevels(temp_GC_Duration)


#Gonotrophic cycle duration

#Adding progrom to the fluc dataframe
temp_GC_Duration$program <- "constant"
temp_GC_Duration.dtr9$program <- "dtr 9"
temp_GC_Duration.dtr12$program <- "dtr 12"

#Combining all the datasets together
all.GC.dur <- rbind(temp_GC_Duration, temp_GC_Duration.dtr9, temp_GC_Duration.dtr12)
all.GC.dur$Treatment <- as.factor(all.GC.dur$Treatment)
all.GC.dur$program <- as.factor(all.GC.dur$program)
all.GC.dur$program <- factor(all.GC.dur$program, levels = c("constant", "dtr 9", "dtr 12"))

#for coloring
categories <- aggregate(program~Treatment,all.GC.dur,function(x)length(unique(x)))  #number of sub-category for each category 
#colors <- unlist(lapply(1:nrow(categories), function(i){colorRampPalette(brewer.pal(9,category.palettes[i])[3:7])(categories[i,2])}))
names <- sort(unique(all.GC.dur$Treatment))

#Plotting GC duration
ggplot(data = all.GC.dur, aes(x=Treatment, y=Dur, fill = interaction(program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
  scale_fill_manual("Temperature", values = c("black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple" ), breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "GC duration", limits = c(0,23), breaks = seq(0,20,5)) +
  geom_errorbar(aes(ymin = Dur - SEM, ymax = Dur  + SEM), width=0.4, size = 0.7, position = position_dodge(0.9)) +
  theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))



#Number of Gonotrophic cycles

#For graphing I do not need constant temp 36C; remove that data and drop the level associated with it.
temp_GC_total <- temp_GC_total[!temp_GC_total$Treatment == 36,]
temp_GC_total <- droplevels(temp_GC_total)

#Adding progrom to the fluc dataframe
temp_GC_total$program <- "constant"
temp_GC_total.dtr9$program <- "dtr 9"
temp_GC_total.dtr12$program <- "dtr 12"


all.GC.tot <- rbind(temp_GC_total, temp_GC_total.dtr9, temp_GC_total.dtr12)
all.GC.tot$Treatment <- as.factor(all.GC.tot$Treatment)
all.GC.tot$program <- as.factor(all.GC.tot$program)
all.GC.tot$program <- factor(all.GC.tot$program, levels = c("constant", "dtr 9", "dtr 12"))



#Plotting tot # GC
ggplot(data = all.GC.tot, aes(x=Treatment, y= GC, fill = interaction(program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
   scale_fill_manual("Temperature", values = c("black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple" ), breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "no. of GC", limits = c(0,8), breaks = seq(0,8,1)) +
  geom_errorbar(aes(ymin = GC - SEM, ymax = GC  + SEM), width=0.4, size = 0.7, position = position_dodge(0.9)) +
  theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))


#Plotting Clutch size

#For graphing I do not need constant temp 36C; remove that data and drop the level associated with it.
temp_clutch_size <- temp_clutch_size[!temp_clutch_size$Treatment == 36,]
temp_clutch_size <- droplevels(temp_clutch_size)

#Adding progrom to the fluc dataframe
temp_clutch_size$program <- "constant"
temp_clutch_size.dtr9$program <- "dtr 9"
temp_clutch_size.dtr12$program <- "dtr 12"

#Putting everything into a single df for graphing
all.clutch_size <- rbind(temp_clutch_size, temp_clutch_size.dtr9, temp_clutch_size.dtr12)
all.clutch_size$Treatment <- as.factor(all.clutch_size$Treatment)
all.clutch_size$program <- as.factor(all.clutch_size$program)
all.clutch_size$program <- factor(all.clutch_size$program, levels = c("constant", "dtr 9", "dtr 12"))



ggplot(data = all.clutch_size, aes(x=Treatment, y= clutch, fill = interaction(program,Treatment))) +
  geom_bar(stat = "identity", position = "dodge") + 
  xlab("Temperature(C)") +
   scale_fill_manual("Temperature", values = c("black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple","black", "dodgerblue", "purple" ), breaks = paste0("1.", names), labels = names)+
  scale_y_continuous(name = "Clutch size", limits = c(0,125), breaks = seq(0,125,25)) +
  geom_errorbar(aes(ymin = clutch - SEM, ymax = clutch  + SEM), width=0.4, size = 0.7, position = position_dodge(0.9)) +
  theme_classic(base_size = 14)+
  theme(legend.position = 'none', panel.background = element_blank(), legend.key = element_rect(colour = NA, fill = NA), panel.border = element_rect(colour="black", fill=NA, size= 0.5))


```

